# GitHub Secrets Setup Guide

This guide explains how to set up all the required GitHub secrets for the CI/CD pipeline.

## üîê Required GitHub Secrets

You need to add these secrets to your GitHub repository:

### How to Add Secrets:
1. Go to your GitHub repository
2. Click **Settings** tab
3. Click **Secrets and variables** ‚Üí **Actions**
4. Click **New repository secret**
5. Add each secret listed below

## üìã Complete Secrets List

### 1. Azure Authentication
```
Name: AZURE_CREDENTIALS
Value: {
  "clientId": "your-client-id",
  "clientSecret": "your-client-secret",
  "subscriptionId": "your-subscription-id",
  "tenantId": "your-tenant-id"
}
```
**Source:** Output from the infrastructure setup script when it creates the service principal

### 2. Azure Container Registry
```
Name: ACR_LOGIN_SERVER
Value: your-acr-name.azurecr.io

Name: ACR_USERNAME
Value: your-acr-username

Name: ACR_PASSWORD
Value: your-acr-password
```
**Source:** Output from the infrastructure setup script

### 3. Azure SQL Database
```
Name: SQL_CONNECTION_STRING
Value: jdbc:sqlserver://your-sql-server.database.windows.net:1433;database=taskmanagerdb;encrypt=true;trustServerCertificate=false;hostNameInCertificate=*.database.windows.net;loginTimeout=30;

Name: SQL_ADMIN_USER
Value: sqladmin

Name: SQL_ADMIN_PASSWORD
Value: your-secure-sql-password
```
**Source:** Values you provided when running the infrastructure setup script

### 4. Application Configuration
```
Name: JWT_SECRET
Value: your-jwt-secret-key
```
**Source:** Generated by the infrastructure setup script and stored in Azure Key Vault

### 5. Azure VM Access
```
Name: VM_PUBLIC_IP
Value: 20.123.45.67

Name: VM_SSH_PRIVATE_KEY
Value: -----BEGIN OPENSSH PRIVATE KEY-----
your-private-key-content-here
-----END OPENSSH PRIVATE KEY-----
```
**Source:** 
- VM_PUBLIC_IP: Output from infrastructure setup script
- VM_SSH_PRIVATE_KEY: Your local SSH private key (`cat ~/.ssh/id_rsa`)

## üöÄ Quick Setup Commands

After running the infrastructure setup script, you can extract the values using these commands:

```bash
# Get your SSH private key
cat ~/.ssh/id_rsa

# Get infrastructure info (if you saved it)
cat azure-setup-info.txt

# Get current Azure account info
az account show

# Get ACR credentials
az acr credential show --name your-acr-name --resource-group your-resource-group
```

## üîç How to Get Each Secret

### AZURE_CREDENTIALS
This is created when you run the infrastructure setup script. Look for output like:
```json
{
  "clientId": "12345678-1234-1234-1234-123456789012",
  "clientSecret": "your-secret-here",
  "subscriptionId": "87654321-4321-4321-4321-210987654321",
  "tenantId": "11111111-1111-1111-1111-111111111111"
}
```

### ACR Credentials
From the infrastructure setup script output:
```
ACR Login Server: taskmanageracr123456789.azurecr.io
ACR Username: taskmanageracr123456789
ACR Password: abc123def456...
```

### SQL Credentials
These are the values you entered when running the setup script:
- Connection string format is shown in the script output
- Admin user is typically `sqladmin`
- Password is what you entered during setup

### VM Information
```bash
# Get VM public IP
az vm show -d -g your-resource-group -n taskmanager-vm --query publicIps -o tsv

# Your SSH private key
cat ~/.ssh/id_rsa
```

## ‚úÖ Verification

After adding all secrets, verify in GitHub:
1. Go to **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**
2. You should see all 8 secrets listed
3. GitHub will show the date they were added

## üîí Security Best Practices

1. **Never commit secrets to code**
2. **Use least privilege access** - Service principal only has Contributor access to the resource group
3. **Rotate secrets regularly** - Especially SSH keys and passwords
4. **Monitor secret usage** - Check GitHub Actions logs for any unauthorized access
5. **Use Azure Key Vault** - For production, consider pulling secrets from Key Vault during deployment

## üêõ Troubleshooting

### Common Issues:

1. **"Secret not found" error**
   - Check secret name spelling (case-sensitive)
   - Ensure secret exists in repository settings

2. **Azure authentication fails**
   - Verify AZURE_CREDENTIALS JSON format
   - Check service principal has correct permissions

3. **ACR login fails**
   - Verify ACR credentials are correct
   - Check ACR admin access is enabled

4. **SSH connection fails**
   - Ensure SSH private key format is correct (including headers/footers)
   - Verify VM security group allows SSH (port 22)

5. **SQL connection fails**
   - Check SQL connection string format
   - Verify SQL server firewall rules allow Azure services

## üìû Need Help?

If you encounter issues:
1. Check the infrastructure setup script output
2. Verify all Azure resources were created successfully
3. Test each secret individually using GitHub Actions debug mode
4. Check Azure portal for resource status and configurations